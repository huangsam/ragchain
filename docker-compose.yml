services:
  chroma:
    image: ghcr.io/chroma-core/chroma:latest
    restart: unless-stopped
    ports:
      - "8000:8000"
    volumes:
      - chroma_data:/data
    healthcheck:
      # Use Chroma v2 heartbeat endpoint (curl is missing in image, use bash tcp hack)
      test: ["CMD-SHELL", "bash -c 'exec 3<>/dev/tcp/localhost/8000; echo -e \"GET /api/v2/heartbeat HTTP/1.1\\r\\nHost: localhost\\r\\nConnection: close\\r\\n\\r\\n\" >&3; cat <&3 | grep \"200 OK\"'"]
      interval: 5s
      timeout: 5s
      retries: 5

volumes:
  chroma_data:
